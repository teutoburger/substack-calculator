<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Substack Umsatz-Rechner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            background-color: #f5f5f4;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
import React, { useState } from 'react';

const SubstackCalculator = () => {
  // Default values
  const defaults = {
    revenueTarget: 1000,
    subscriberCount: 1000,
    monthlyPrice: 5,
    conversionRate: 3,
    monthlyPercent: 30,
    yearlyPercent: 69,
    foundingPercent: 1,
    yearlyMultiplier: 10,
    foundingMultiplier: 25
  };

  // State
  const [mode, setMode] = useState('revenueToSubs');
  const [revenueTarget, setRevenueTarget] = useState(defaults.revenueTarget);
  const [subscriberCount, setSubscriberCount] = useState(defaults.subscriberCount);
  const [monthlyPrice, setMonthlyPrice] = useState(defaults.monthlyPrice);
  const [conversionRate, setConversionRate] = useState(defaults.conversionRate);
  const [monthlyPercent, setMonthlyPercent] = useState(defaults.monthlyPercent);
  const [yearlyPercent, setYearlyPercent] = useState(defaults.yearlyPercent);
  const [foundingPercent, setFoundingPercent] = useState(defaults.foundingPercent);
  const [yearlyMultiplier, setYearlyMultiplier] = useState(defaults.yearlyMultiplier);
  const [foundingMultiplier, setFoundingMultiplier] = useState(defaults.foundingMultiplier);
  const [showExpertSettings, setShowExpertSettings] = useState(false);

  // Input state for controlled inputs (to handle leading zeros)
  const [inputValues, setInputValues] = useState({
    revenueTarget: defaults.revenueTarget.toString(),
    subscriberCount: defaults.subscriberCount.toString(),
    monthlyPrice: defaults.monthlyPrice.toString(),
    conversionRate: defaults.conversionRate.toString(),
    monthlyPercent: defaults.monthlyPercent.toString(),
    yearlyPercent: defaults.yearlyPercent.toString(),
    foundingPercent: defaults.foundingPercent.toString(),
    yearlyMultiplier: defaults.yearlyMultiplier.toString(),
    foundingMultiplier: defaults.foundingMultiplier.toString()
  });

  // Handle input change - prevents leading zeros
  const handleInputChange = (field, value, setter) => {
    // Allow empty string for clearing
    if (value === '') {
      setInputValues(prev => ({ ...prev, [field]: '' }));
      setter(0);
      return;
    }
    
    // Remove leading zeros (except for "0" itself or "0.")
    let cleanValue = value.replace(/^0+(?=\d)/, '');
    
    // Parse the number
    const numValue = parseFloat(cleanValue) || 0;
    
    setInputValues(prev => ({ ...prev, [field]: cleanValue }));
    setter(numValue);
  };

  // Handle blur - restore default if empty
  const handleInputBlur = (field, value, defaultValue) => {
    if (value === '' || value === '0') {
      setInputValues(prev => ({ ...prev, [field]: defaultValue.toString() }));
    }
  };

  // Reset function
  const resetToDefaults = () => {
    setRevenueTarget(defaults.revenueTarget);
    setSubscriberCount(defaults.subscriberCount);
    setMonthlyPrice(defaults.monthlyPrice);
    setConversionRate(defaults.conversionRate);
    setMonthlyPercent(defaults.monthlyPercent);
    setYearlyPercent(defaults.yearlyPercent);
    setFoundingPercent(defaults.foundingPercent);
    setYearlyMultiplier(defaults.yearlyMultiplier);
    setFoundingMultiplier(defaults.foundingMultiplier);
    setInputValues({
      revenueTarget: defaults.revenueTarget.toString(),
      subscriberCount: defaults.subscriberCount.toString(),
      monthlyPrice: defaults.monthlyPrice.toString(),
      conversionRate: defaults.conversionRate.toString(),
      monthlyPercent: defaults.monthlyPercent.toString(),
      yearlyPercent: defaults.yearlyPercent.toString(),
      foundingPercent: defaults.foundingPercent.toString(),
      yearlyMultiplier: defaults.yearlyMultiplier.toString(),
      foundingMultiplier: defaults.foundingMultiplier.toString()
    });
  };

  // Calculated values
  const yearlyPrice = monthlyPrice * yearlyMultiplier;
  const foundingPrice = monthlyPrice * foundingMultiplier;
  const platformFeeRate = 0.13; // 10% Substack + 3% Stripe

  // Weighted average months per paid subscriber
  const weightedMonths = 
    (monthlyPercent / 100) * 12 + 
    (yearlyPercent / 100) * yearlyMultiplier + 
    (foundingPercent / 100) * foundingMultiplier;

  // Percentage validation
  const percentageSum = monthlyPercent + yearlyPercent + foundingPercent;
  const percentageValid = Math.abs(percentageSum - 100) < 0.01;

  // Calculations for Mode 1: Revenue Target → Subscribers
  const calculateFromRevenue = () => {
    const grossRevenue = revenueTarget / (1 - platformFeeRate);
    const revenuePerPaidSub = monthlyPrice * weightedMonths;
    const paidSubsNeeded = grossRevenue / revenuePerPaidSub;
    const totalSubsNeeded = paidSubsNeeded / (conversionRate / 100);
    const fees = grossRevenue * platformFeeRate;
    
    return {
      paidSubs: Math.ceil(paidSubsNeeded),
      totalSubs: Math.ceil(totalSubsNeeded),
      grossRevenue: grossRevenue,
      fees: fees
    };
  };

  // Calculations for Mode 2: Subscribers → Revenue
  const calculateFromSubscribers = () => {
    const paidSubs = subscriberCount * (conversionRate / 100);
    const revenuePerPaidSub = monthlyPrice * weightedMonths;
    const grossRevenue = paidSubs * revenuePerPaidSub;
    const fees = grossRevenue * platformFeeRate;
    const netRevenue = grossRevenue - fees;
    
    return {
      paidSubs: Math.round(paidSubs),
      netRevenue: netRevenue,
      grossRevenue: grossRevenue,
      fees: fees
    };
  };

  const results = mode === 'revenueToSubs' ? calculateFromRevenue() : calculateFromSubscribers();

  // Format currency
  const formatCurrency = (value) => {
    return new Intl.NumberFormat('de-DE', {
      style: 'currency',
      currency: 'EUR',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(value);
  };

  // Format number
  const formatNumber = (value) => {
    return new Intl.NumberFormat('de-DE').format(value);
  };

  // Tooltip component
  const Tooltip = ({ text }) => (
    <div className="group relative inline-block ml-1">
      <span className="cursor-help text-gray-400 hover:text-gray-600">ⓘ</span>
      <div className="invisible group-hover:visible absolute z-10 w-64 p-2 mt-1 text-sm text-white bg-gray-800 rounded-lg shadow-lg -left-28 top-6">
        {text}
      </div>
    </div>
  );

  return (
    <div className="max-w-xl mx-auto p-6 bg-white rounded-xl shadow-lg">
      {/* Header with Reset Button */}
      <div className="flex justify-between items-start mb-2">
        <div>
          <h1 className="text-2xl font-bold text-gray-800">Substack Umsatz-Rechner</h1>
          <p className="text-gray-600 mt-1">
            Schluss mit Pi mal Daumen! So viele Abos brauchst du für deinen Wunsch-Umsatz
          </p>
        </div>
        <button
          onClick={resetToDefaults}
          className="text-sm text-orange-600 hover:text-orange-700 hover:underline whitespace-nowrap ml-4"
        >
          Zurücksetzen
        </button>
      </div>

      {/* Mode Toggle */}
      <div className="flex rounded-lg bg-gray-100 p-1 mt-4 mb-6">
        <button
          onClick={() => setMode('revenueToSubs')}
          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
            mode === 'revenueToSubs'
              ? 'bg-orange-500 text-white shadow'
              : 'text-gray-600 hover:text-gray-800'
          }`}
        >
          Umsatz → Abos
        </button>
        <button
          onClick={() => setMode('subsToRevenue')}
          className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
            mode === 'subsToRevenue'
              ? 'bg-orange-500 text-white shadow'
              : 'text-gray-600 hover:text-gray-800'
          }`}
        >
          Abos → Umsatz
        </button>
      </div>

      {/* Input Section */}
      <div className="space-y-4 mb-6">
        {mode === 'revenueToSubs' ? (
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Wunsch-Umsatz pro Jahr
            </label>
            <div className="relative">
              <input
                type="text"
                inputMode="numeric"
                value={inputValues.revenueTarget}
                onChange={(e) => handleInputChange('revenueTarget', e.target.value, setRevenueTarget)}
                onBlur={() => handleInputBlur('revenueTarget', inputValues.revenueTarget, defaults.revenueTarget)}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
              />
              <span className="absolute right-4 top-3 text-gray-500">€</span>
            </div>
            <p className="text-sm text-gray-500 mt-1">
              nach Abzug der Gebühren für Substack und Stripe
            </p>
          </div>
        ) : (
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Gesamtzahl Abos
            </label>
            <input
              type="text"
              inputMode="numeric"
              value={inputValues.subscriberCount}
              onChange={(e) => handleInputChange('subscriberCount', e.target.value, setSubscriberCount)}
              onBlur={() => handleInputBlur('subscriberCount', inputValues.subscriberCount, defaults.subscriberCount)}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
            />
          </div>
        )}

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Preis Monats-Abo
          </label>
          <div className="relative">
            <input
              type="text"
              inputMode="numeric"
              value={inputValues.monthlyPrice}
              onChange={(e) => handleInputChange('monthlyPrice', e.target.value, setMonthlyPrice)}
              onBlur={() => handleInputBlur('monthlyPrice', inputValues.monthlyPrice, defaults.monthlyPrice)}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
            />
            <span className="absolute right-4 top-3 text-gray-500">€</span>
          </div>
          <p className="text-sm text-gray-500 mt-1">
            Jahresabo: {formatCurrency(yearlyPrice)} · Founding Member: {formatCurrency(foundingPrice)}
            <Tooltip text="Die Preise für Jahresabo und Founding Member werden aus dem Monats-Preis berechnet. Du kannst die Multiplikatoren in den Experten-Einstellungen anpassen." />
          </p>
        </div>
      </div>

      {/* Expert Settings */}
      <div className="mb-6">
        <button
          onClick={() => setShowExpertSettings(!showExpertSettings)}
          className="flex items-center text-sm text-gray-600 hover:text-gray-800"
        >
          <span className="mr-1">{showExpertSettings ? '▼' : '▶'}</span>
          Experten-Einstellungen
        </button>
        
        {showExpertSettings && (
          <div className="mt-4 p-4 bg-gray-50 rounded-lg space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Conversion Rate (%)
                <Tooltip text="Prozentsatz deiner Gesamt-Abonnent*innen, die zu zahlenden Abonnent*innen werden. 3% ist ein üblicher Wert." />
              </label>
              <input
                type="text"
                inputMode="numeric"
                value={inputValues.conversionRate}
                onChange={(e) => handleInputChange('conversionRate', e.target.value, setConversionRate)}
                onBlur={() => handleInputBlur('conversionRate', inputValues.conversionRate, defaults.conversionRate)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Preismultiplikatoren
                <Tooltip text="Wie viel mal den Preis eines Monats-Abos kostet ein Jahres- und ein Founding Member-Abo?" />
              </label>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <span className="text-xs text-gray-500">Jahresabo</span>
                  <div className="relative">
                    <input
                      type="text"
                      inputMode="numeric"
                      value={inputValues.yearlyMultiplier}
                      onChange={(e) => handleInputChange('yearlyMultiplier', e.target.value, setYearlyMultiplier)}
                      onBlur={() => handleInputBlur('yearlyMultiplier', inputValues.yearlyMultiplier, defaults.yearlyMultiplier)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                    />
                    <span className="absolute right-4 top-2 text-gray-500">×</span>
                  </div>
                </div>
                <div>
                  <span className="text-xs text-gray-500">Founding Member</span>
                  <div className="relative">
                    <input
                      type="text"
                      inputMode="numeric"
                      value={inputValues.foundingMultiplier}
                      onChange={(e) => handleInputChange('foundingMultiplier', e.target.value, setFoundingMultiplier)}
                      onBlur={() => handleInputBlur('foundingMultiplier', inputValues.foundingMultiplier, defaults.foundingMultiplier)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                    />
                    <span className="absolute right-4 top-2 text-gray-500">×</span>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                Verteilung der Abo-Typen (%)
                <Tooltip text="Wie verteilen sich deine zahlenden Abonnent*innen auf die verschiedenen Abo-Typen? Branchen-Durchschnitt: 30% Monats-, 69% Jahres-, 1% Founding Member-Abos." />
              </label>
              <div className="grid grid-cols-3 gap-2">
                <div>
                  <span className="text-xs text-gray-500">Monats-Abo</span>
                  <input
                    type="text"
                    inputMode="numeric"
                    value={inputValues.monthlyPercent}
                    onChange={(e) => handleInputChange('monthlyPercent', e.target.value, setMonthlyPercent)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                  />
                </div>
                <div>
                  <span className="text-xs text-gray-500">Jahres-Abo</span>
                  <input
                    type="text"
                    inputMode="numeric"
                    value={inputValues.yearlyPercent}
                    onChange={(e) => handleInputChange('yearlyPercent', e.target.value, setYearlyPercent)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                  />
                </div>
                <div>
                  <span className="text-xs text-gray-500">Founding</span>
                  <input
                    type="text"
                    inputMode="numeric"
                    value={inputValues.foundingPercent}
                    onChange={(e) => handleInputChange('foundingPercent', e.target.value, setFoundingPercent)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                  />
                </div>
              </div>
              {!percentageValid && (
                <p className="text-sm text-red-500 mt-2">
                  ⚠️ Die Summe der Prozente beträgt {percentageSum.toFixed(0)}% (sollte 100% sein)
                </p>
              )}
            </div>
          </div>
        )}
      </div>

      {/* Results */}
      <div className="bg-orange-50 rounded-lg p-4">
        <h2 className="text-lg font-semibold text-gray-800 mb-3">Ergebnis</h2>
        
        {mode === 'revenueToSubs' ? (
          <div className="space-y-2">
            <div className="flex justify-between">
              <span className="text-gray-600">Benötigte Abos (Paid)</span>
              <span className="font-semibold">{formatNumber(results.paidSubs)}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">Benötigte Abos (Gesamt)</span>
              <span className="font-semibold">{formatNumber(results.totalSubs)}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">Erlöse aus Abos</span>
              <span className="font-semibold">{formatCurrency(results.grossRevenue)}</span>
            </div>
            <div className="flex justify-between border-t pt-2">
              <span className="text-gray-600">
                Gebühren (13%)
                <Tooltip text="Substack behält 10% der Einnahmen. Stripe (Zahlungsabwicklung) berechnet ca. 3%." />
              </span>
              <span className="font-semibold text-red-600">-{formatCurrency(results.fees)}</span>
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            <div className="flex justify-between">
              <span className="text-gray-600">Erwartete Paid-Abos</span>
              <span className="font-semibold">{formatNumber(results.paidSubs)}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">Gesamt-Umsatz</span>
              <span className="font-semibold">{formatCurrency(results.grossRevenue)}</span>
            </div>
            <div className="flex justify-between">
              <span className="text-gray-600">
                Gebühren (13%)
                <Tooltip text="Substack behält 10% der Einnahmen. Stripe (Zahlungsabwicklung) berechnet ca. 3%." />
              </span>
              <span className="font-semibold text-red-600">-{formatCurrency(results.fees)}</span>
            </div>
            <div className="flex justify-between border-t pt-2">
              <span className="text-gray-600 font-medium">Erlös pro Jahr</span>
              <span className="font-bold text-green-600">{formatCurrency(results.netRevenue)}</span>
            </div>
          </div>
        )}
      </div>

      {/* Credit */}
      <p className="text-center text-xs text-gray-400 mt-4">
        Ein Tool von{' '}
        <a href="https://thcrtrshft.substack.com" className="underline hover:text-orange-500">
          The Creator Shift
        </a>
      </p>
    </div>
  );
};

export default SubstackCalculator;

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<SubstackCalculator />);
    </script>
</body>
</html>
